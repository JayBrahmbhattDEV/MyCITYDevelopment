<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Add Report</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form [formGroup]="reportForm" (ngSubmit)="addReport()">
    <ion-img
      class="add-report-image"
      (click)="openCamera()"
      [src]="image"
    ></ion-img>
    <ion-list>
      <ion-item class="ion-margin-vertical">
        <ion-label position="floating">Category</ion-label>
        <ion-select
          formControlName="category"
          (ionChange)="getSubCategory($event)"
          placeholder="Select Category"
          okText="Okay"
          cancelText="Cancel"
        >
          <ion-select-option
            *ngFor="let category of categories"
            [value]="category.id"
          >
            {{ category.text }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item class="ion-margin-vertical">
        <ion-label position="floating">Sub Category</ion-label>
        <ion-select
          #subCategory
          formControlName="subCategory"
          [disabled]="!subCategoriesTemp.length"
          placeholder="Select Sub Category"
          okText="Okay"
          cancelText="Cancel"
        >
          <ion-select-option
            *ngFor="let category of subCategoriesTemp"
            [value]="category.id"
          >
            {{ category.text }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item lines="none" class="ion-margin-vertical">
        <ion-label position="stacked">Description</ion-label>
        <ion-textarea
          formControlName="description"
          placeholder="Please describe your problem"
        >
        </ion-textarea>
      </ion-item>
      <ion-item class="ion-margin-vertical">
        <ion-icon slot="start" name="location"></ion-icon>
        <ion-label>
          {{ this.addressVal || reportForm?.value?.address || this.longitudeVal}}
        </ion-label>
      </ion-item>
      <ion-card *ngIf="!isMapLoading">
        <div class="map-container">
          <app-mc-map [disabled]="true" [latLong]="latLong"></app-mc-map>
        </div>
      </ion-card>
      <ion-button
        id="open-modal"
        class="ion-margin-horizontal"
        shape="round"
        expand="block"
      >
        <ion-text>Change Location</ion-text>
      </ion-button>
      <ion-button
        type="submit"
        class="ion-margin-horizontal"
        shape="round"
        expand="block"
      >
        <ion-text>Add Report</ion-text>
      </ion-button>
    </ion-list>
  </form>
  <ion-modal trigger="open-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-icon (click)="cancel()" name="close-outline"></ion-icon>
          </ion-buttons>
          <ion-title>Search for your location</ion-title>
        </ion-toolbar>
        <ion-toolbar>
          <ion-searchbar (ionChange)="searchLocation($event)"></ion-searchbar>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-list>
          <ion-item
            (click)="chooseLocation(location)"
            *ngFor="let location of locations"
          >
            <ion-icon slot="start" name="location-outline"></ion-icon>
            <ion-label class="ion-text-wrap">
              <h3><b>{{location.label}}</b></h3>
              <p class="ion-text-wrap">{{location.label}}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
      <ion-footer>
        <ion-toolbar>
          <ion-title class="ion-text-center">
            <ion-text (click)="openMap()"> Choose location on map </ion-text>
          </ion-title>
        </ion-toolbar>
      </ion-footer>
    </ng-template>
  </ion-modal>
</ion-content>
